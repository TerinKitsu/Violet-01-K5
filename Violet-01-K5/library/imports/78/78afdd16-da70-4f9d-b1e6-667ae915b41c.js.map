{"version":3,"sources":["../../../../../../assets/Day2/Bai1/Data_21/assets/Day2/Bai1/Data_21/GameControl.js"],"names":["cc","Class","extends","Component","properties","playerNode","Node","enemyNode","notify","Label","gameEnd","chargeBtn","Button","onLoad","player","getComponent","enemy","isGameOver","playerSprite","playerImg","enemySprite","enemyImg","start","string","update","dt","playerEnergy","interactable","onClickAttack","playerAttack","onClickSkill","onClickCharge","onChargeEnergy","energyLb","type","damage","Math","max","enemyDefense","enemyHP","hpLb","active","scheduleOnce","enemyTurn","enemyAttack","playerDefense","playerHP"],"mappings":"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","file":"GameControl.js","sourceRoot":"../../../../../../assets/Day2/Bai1/Data_21","sourcesContent":["\n//Quản lý lượt(khi nào biết là user đang đánh và khi lượt của quái thì user không được spam kỹ năng)\n//Máu ko được âm\n//Thanh energy đầy sẽ không cho spam nút charge hoặc sẽ không mất lượt user khi spam energy\n//Random HP và def mỗi khi tấn công thay vì random cố định khi bắt đầu trò chơi\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        playerNode: cc.Node,\n        enemyNode: cc.Node,\n        notify: cc.Label,\n        gameEnd: cc.Node,\n        chargeBtn: cc.Button,\n    },\n\n    onLoad () {\n        this.player = this.playerNode.getComponent('Player_D2B1');\n        this.enemy = this.enemyNode.getComponent('Enemy_D2B1');\n        this.isGameOver = false;\n\n        this.playerSprite = this.player.playerImg;\n        this.enemySprite = this.enemy.enemyImg;\n    },\n\n    start(){\n\n        this.notify.string = \"\";\n    },\n    update(dt){\n        this.player.playerEnergy == 100? this.chargeBtn.interactable = false : this.chargeBtn.interactable = true;\n    },\n\n    onClickAttack() {\n        this.playerAttack(\"attack\");\n    },\n\n    onClickSkill() {\n        this.playerAttack(\"skill\");\n    },\n\n    onClickCharge() {\n        // this.playerAttack(\"charge\");\n        this.player.onChargeEnergy();\n        this.player.energyLb.string = \"Energy: \" + this.player.playerEnergy;\n    },\n\n    playerAttack(type) {\n        if (this.isGameOver) return;\n       \n        let damage = 0;\n\n        if (type === \"attack\") {\n            \n            damage = Math.max(0, this.player.playerAttack - this.enemy.enemyDefense);\n            this.enemy.enemyHP -= damage;\n            this.enemy.hpLb.string = \"HP: \" + this.enemy.enemyHP;\n        } \n        else if (type === \"skill\") {\n            if (this.player.playerEnergy >= 30) {\n                damage = Math.max(0, (this.player.playerAttack * 2) - this.enemy.enemyDefense);\n                this.enemy.enemyHP -= damage;\n                this.player.playerEnergy -= 30;\n                this.enemy.hpLb.string = \"HP: \" + this.enemy.enemyHP;\n                this.player.energyLb.string = \"Energy: \" + this.player.playerEnergy;\n            } \n            else {\n                return;\n            }\n        } \n        // else if (type === \"charge\") {\n        //     this.player.onChargeEnergy();\n        //     this.player.hpLb.string = \"HP: \" + this.player.playerHP;\n        // }\n\n        if (this.enemy.enemyHP <= 0) {\n            this.enemy.enemyHP = 0;\n            this.isGameOver = true;\n            this.gameEnd.active = true;\n            this.notify.string = \"You Win\";\n            return;\n        }\n\n        this.scheduleOnce(() => this.enemyTurn(), 1); \n    },\n\n    enemyTurn() {\n        if (this.isGameOver) return;\n\n        const damage = Math.max(0, this.enemy.enemyAttack - this.player.playerDefense);\n        this.player.playerHP -= damage;\n        this.player.hpLb.string = \"HP: \" + this.player.playerHP;\n\n        if (this.player.playerHP <= 0) {\n            this.player.playerHP = 0;\n            this.isGameOver = true;\n            this.gameEnd.active = true;\n            this.notify.string = \"You Lose\";\n        }\n    },\n});\n"]}